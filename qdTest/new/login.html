<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¬¢è¿ä½¿ç”¨ KYX ç­¾åˆ°ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        /* ç™»å½•é¡µé¢ä¸“å±æ ·å¼ */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #0f0f0f;
            position: relative;
            overflow: hidden;
        }

        /* èƒŒæ™¯è£…é¥° */
        .bg-decoration {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }

        .bg-decoration::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background: radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.02) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.02) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translate(0, 0) rotate(0deg);
            }

            33% {
                transform: translate(-20px, -20px) rotate(1deg);
            }

            66% {
                transform: translate(20px, -10px) rotate(-1deg);
            }
        }

        /* ç½‘æ ¼èƒŒæ™¯ */
        .grid-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.3;
        }

        /* ç™»å½•å¡ç‰‡ */
        .login-card {
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 420px;
            padding: var(--spacing-2xl);
            text-align: center;
        }

        /* LogoåŒºåŸŸ */
        .logo-container {
            margin-bottom: var(--spacing-2xl);
            animation: fadeInDown 0.8s ease-out;
        }

        .logo-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--spacing-lg);
            background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-3xl);
            box-shadow: 0 10px 40px rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: translateX(-100%);
            animation: shine 3s ease-in-out infinite;
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .logo-text {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            color: #fff;
            margin-bottom: var(--spacing-sm);
            letter-spacing: 2px;
        }

        .logo-subtitle {
            font-size: var(--text-sm);
            color: var(--color-text-tertiary);
            letter-spacing: 1px;
        }

        /* ç™»å½•æŒ‰é’® */
        .login-btn {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-xl);
            background: #fff;
            color: #0f0f0f;
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--text-base);
            font-weight: var(--font-semibold);
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.2);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .login-btn-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-btn-text {
            flex: 1;
        }

        /* ç®¡ç†å‘˜ç™»å½•æŒ‰é’® */
        .admin-login-trigger {
            position: fixed; /* æ”¹ä¸º fixed ç¡®ä¿ä¸è¢«å…¶ä»–å…ƒç´ é®æŒ¡ */
            top: 24px; /* var(--spacing-lg) åå¤‡å€¼ */
            right: 24px; /* var(--spacing-lg) åå¤‡å€¼ */
            padding: 8px 16px; /* var(--spacing-sm) var(--spacing-md) åå¤‡å€¼ */
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px; /* var(--radius-md) åå¤‡å€¼ */
            color: #adb5bd; /* var(--color-text-secondary) åå¤‡å€¼ */
            font-size: 14px; /* var(--text-sm) åå¤‡å€¼ */
            cursor: pointer;
            transition: all 0.25s; /* var(--transition-base) åå¤‡å€¼ */
            backdrop-filter: blur(10px);
            z-index: 1000; /* æé«˜ z-index */
            pointer-events: auto; /* ç¡®ä¿å¯ä»¥æ¥æ”¶ç‚¹å‡»äº‹ä»¶ */
        }

        .admin-login-trigger:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* ç®¡ç†å‘˜ç™»å½•æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex !important;
        }

        .modal-content {
            background: #1a1a1a; /* var(--color-bg-elevated) åå¤‡å€¼ */
            border: 1px solid #2c2c2c; /* var(--color-border-primary) åå¤‡å€¼ */
            border-radius: 16px; /* var(--radius-xl) åå¤‡å€¼ */
            padding: 32px; /* var(--spacing-2xl) åå¤‡å€¼ */
            width: 90%;
            max-width: 400px;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 32px; /* var(--spacing-xl) åå¤‡å€¼ */
        }

        .modal-title {
            font-size: 20px; /* var(--text-xl) åå¤‡å€¼ */
            font-weight: 600; /* var(--font-semibold) åå¤‡å€¼ */
            color: #f8f9fa; /* var(--color-text-primary) åå¤‡å€¼ */
            margin: 0;
        }

        .form-group {
            margin-bottom: 24px; /* var(--spacing-lg) åå¤‡å€¼ */
        }

        .form-label {
            display: block;
            margin-bottom: 8px; /* var(--spacing-sm) åå¤‡å€¼ */
            font-size: 14px; /* var(--text-sm) åå¤‡å€¼ */
            color: #adb5bd; /* var(--color-text-secondary) åå¤‡å€¼ */
        }

        .form-input {
            width: 100%;
            padding: 8px 16px; /* var(--spacing-sm) var(--spacing-md) åå¤‡å€¼ */
            background: #262626; /* var(--color-bg-secondary) åå¤‡å€¼ */
            border: 1px solid #2c2c2c; /* var(--color-border-secondary) åå¤‡å€¼ */
            border-radius: 8px; /* var(--radius-md) åå¤‡å€¼ */
            color: #f8f9fa; /* var(--color-text-primary) åå¤‡å€¼ */
            font-size: 16px; /* var(--text-base) åå¤‡å€¼ */
            transition: all 0.15s; /* var(--transition-fast) åå¤‡å€¼ */
            box-sizing: border-box;
        }

        .form-input:focus {
            outline: none;
            border-color: #f8f9fa; /* var(--color-accent) åå¤‡å€¼ */
            background: #0f0f0f; /* var(--color-bg-primary) åå¤‡å€¼ */
        }

        .form-actions {
            display: flex;
            gap: 16px; /* var(--spacing-md) åå¤‡å€¼ */
            margin-top: 32px; /* var(--spacing-xl) åå¤‡å€¼ */
        }

        .btn {
            flex: 1;
            padding: 8px 24px; /* var(--spacing-sm) var(--spacing-lg) åå¤‡å€¼ */
            border: none;
            border-radius: 8px; /* var(--radius-md) åå¤‡å€¼ */
            font-size: 16px; /* var(--text-base) åå¤‡å€¼ */
            font-weight: 500; /* var(--font-medium) åå¤‡å€¼ */
            cursor: pointer;
            transition: all 0.25s; /* var(--transition-base) åå¤‡å€¼ */
        }

        .btn-primary {
            background: #f8f9fa; /* var(--color-accent) åå¤‡å€¼ */
            color: #0f0f0f; /* var(--color-text-inverse) åå¤‡å€¼ */
        }

        .btn-primary:hover {
            background: #e9ecef; /* var(--color-accent-hover) åå¤‡å€¼ */
        }

        .btn-secondary {
            background: #262626; /* var(--color-bg-secondary) åå¤‡å€¼ */
            color: #adb5bd; /* var(--color-text-secondary) åå¤‡å€¼ */
            border: 1px solid #2c2c2c; /* var(--color-border-secondary) åå¤‡å€¼ */
        }

        .btn-secondary:hover {
            background: #2c2c2c; /* var(--color-bg-tertiary) åå¤‡å€¼ */
            color: #f8f9fa; /* var(--color-text-primary) åå¤‡å€¼ */
        }

        /* æœåŠ¡æ¡æ¬¾ */
        .terms {
            margin-top: var(--spacing-xl);
            font-size: var(--text-xs);
            color: var(--color-text-tertiary);
            line-height: var(--leading-relaxed);
            animation: fadeIn 0.8s ease-out 0.4s both;
        }

        .terms a {
            color: var(--color-text-secondary);
            text-decoration: underline;
            transition: color var(--transition-fast);
        }

        .terms a:hover {
            color: #fff;
        }

        /* åŠ¨ç”» */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading-state {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(4px);
            border-radius: var(--radius-lg);
            align-items: center;
            justify-content: center;
            z-index: 20;
        }

        .loading-state.active {
            display: flex;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* é”™è¯¯æç¤º */
        .error-message {
            display: none;
            margin-top: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-md);
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--radius-md);
            color: #ef4444;
            font-size: var(--text-sm);
            animation: shake 0.5s ease-in-out;
        }

        .error-message.active {
            display: block;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            10%,
            30%,
            50%,
            70%,
            90% {
                transform: translateX(-5px);
            }

            20%,
            40%,
            60%,
            80% {
                transform: translateX(5px);
            }
        }

        /* å“åº”å¼ */
        @media (max-width: 480px) {
            .login-card {
                padding: var(--spacing-xl);
            }

            .logo-icon {
                width: 60px;
                height: 60px;
                font-size: var(--text-2xl);
            }

            .logo-text {
                font-size: var(--text-xl);
            }
        }
    </style>
</head>

<body>
    <div class="login-container">
        <!-- èƒŒæ™¯è£…é¥° -->
        <div class="bg-decoration"></div>
        <div class="grid-bg"></div>

        <!-- ç®¡ç†å‘˜ç™»å½•å…¥å£ -->
        <button class="admin-login-trigger" id="adminLoginTrigger">
            ç®¡ç†å‘˜ç™»å½•
        </button>

        <!-- ç™»å½•å¡ç‰‡ -->
        <div class="login-card">
            <div class="logo-container">
                <div class="logo-icon">
                    <span style="color: #0f0f0f;">ğŸ“…</span>
                </div>
                <h1 class="logo-text">KYX ç­¾åˆ°ç³»ç»Ÿ</h1>
                <p class="logo-subtitle">æ¯æ—¥ç­¾åˆ° Â· é¢†å–å…‘æ¢ç </p>
            </div>

            <button class="login-btn" id="loginBtn">
                <span class="login-btn-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </span>
                <span class="login-btn-text">ä½¿ç”¨ Linux Do è´¦æˆ·ç™»å½•</span>
            </button>

            <div class="error-message" id="errorMessage"></div>

            <div class="loading-state" id="loadingState">
                <div class="loading-spinner"></div>
            </div>

            <p class="terms">
                ç™»å½•å³è¡¨ç¤ºæ‚¨åŒæ„æˆ‘ä»¬çš„
                <a href="#" onclick="event.preventDefault()">æœåŠ¡æ¡æ¬¾</a>
                å’Œ
                <a href="#" onclick="event.preventDefault()">éšç§æ”¿ç­–</a>
            </p>
        </div>
    </div>

    <!-- ç®¡ç†å‘˜ç™»å½•æ¨¡æ€æ¡† -->
    <div class="modal" id="adminLoginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ç®¡ç†å‘˜ç™»å½•</h2>
            </div>
            <form id="adminLoginForm">
                <div class="form-group">
                    <label class="form-label" for="adminUsername">ç”¨æˆ·å</label>
                    <input type="text" id="adminUsername" class="form-input" required placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜ç”¨æˆ·å">
                </div>
                <div class="form-group">
                    <label class="form-label" for="adminPassword">å¯†ç </label>
                    <input type="password" id="adminPassword" class="form-input" required placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
                </div>
                <div class="error-message" id="adminErrorMessage"></div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelAdminLogin">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">ç™»å½•</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script>
        // ä½¿ç”¨é…ç½®ç³»ç»Ÿä¸­çš„ API åœ°å€ï¼Œå¦‚æœé…ç½®æœªåŠ è½½åˆ™ä½¿ç”¨é»˜è®¤å€¼
        const API_URL = window.CONFIG?.API_BASE_URL || (window.location.hostname === 'localhost'
            ? 'http://localhost:8787'
            : 'https://apisign.kkyyxx.xyz');

        // è·å–å…ƒç´ 
        const loginBtn = document.getElementById('loginBtn');
        const loadingState = document.getElementById('loadingState');
        const errorMessage = document.getElementById('errorMessage');
        const adminLoginTrigger = document.getElementById('adminLoginTrigger');
        const adminLoginModal = document.getElementById('adminLoginModal');
        const adminLoginForm = document.getElementById('adminLoginForm');
        const adminErrorMessage = document.getElementById('adminErrorMessage');
        const cancelAdminLogin = document.getElementById('cancelAdminLogin');

        // è°ƒè¯•ä¿¡æ¯
        console.log('é¡µé¢å…ƒç´ æ£€æŸ¥:', {
            loginBtn: !!loginBtn,
            adminLoginTrigger: !!adminLoginTrigger,
            adminLoginModal: !!adminLoginModal,
            adminLoginForm: !!adminLoginForm
        });

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message, isAdmin = false) {
            const errorEl = isAdmin ? adminErrorMessage : errorMessage;
            errorEl.textContent = message;
            errorEl.classList.add('active');
            setTimeout(() => {
                errorEl.classList.remove('active');
            }, 5000);
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(show = true) {
            if (show) {
                loadingState.classList.add('active');
                loginBtn.disabled = true;
            } else {
                loadingState.classList.remove('active');
                loginBtn.disabled = false;
            }
        }

        // å¤„ç†OAuthç™»å½•
        async function handleLogin() {
            showLoading(true);
            errorMessage.classList.remove('active');

            try {
                const response = await fetch(`${API_URL}/api/auth/login`, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('è·å–ç™»å½•é“¾æ¥å¤±è´¥');
                }

                const data = await response.json();

                if (data.success && data.authUrl) {
                    // è·³è½¬åˆ°OAuthæˆæƒé¡µé¢
                    window.location.href = data.authUrl;
                } else {
                    throw new Error(data.error || 'ç™»å½•å¤±è´¥');
                }
            } catch (error) {
                console.error('Login error:', error);
                showError(error.message || 'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
                showLoading(false);
            }
        }

        // å¤„ç†ç®¡ç†å‘˜ç™»å½•
        async function handleAdminLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            adminErrorMessage.classList.remove('active');

            try {
                const response = await fetch(`${API_URL}/api/admin/login`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    // ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°ç®¡ç†åå°
                    window.location.href = 'admin.html';
                } else {
                    throw new Error(data.error || 'ç™»å½•å¤±è´¥');
                }
            } catch (error) {
                console.error('Admin login error:', error);
                showError(error.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ', true);
            }
        }

        // æ˜¾ç¤º/éšè—ç®¡ç†å‘˜ç™»å½•æ¨¡æ€æ¡†
        function toggleAdminModal(show) {
            if (show) {
                adminLoginModal.classList.add('active');
                document.getElementById('adminUsername').focus();
            } else {
                adminLoginModal.classList.remove('active');
                adminLoginForm.reset();
                adminErrorMessage.classList.remove('active');
            }
        }

        // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
        async function checkAuth() {
            try {
                const response = await fetch(`${API_URL}/api/user`, {
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.user) {
                        // å·²ç™»å½•ï¼Œæ ¹æ®æ˜¯å¦æ˜¯ç®¡ç†å‘˜è·³è½¬åˆ°ä¸åŒé¡µé¢
                        if (data.user.is_admin) {
                            window.location.href = 'admin.html';
                        } else {
                            window.location.href = 'index.html';
                        }
                    }
                }
            } catch (error) {
                console.error('Auth check error:', error);
            }
        }

        // ç»‘å®šäº‹ä»¶
        loginBtn.addEventListener('click', handleLogin);
        
        if (adminLoginTrigger) {
            adminLoginTrigger.addEventListener('click', () => {
                console.log('ç®¡ç†å‘˜ç™»å½•æŒ‰é’®è¢«ç‚¹å‡»');
                toggleAdminModal(true);
            });
            console.log('ç®¡ç†å‘˜ç™»å½•æŒ‰é’®äº‹ä»¶å·²ç»‘å®š');
        } else {
            console.error('æ‰¾ä¸åˆ°ç®¡ç†å‘˜ç™»å½•æŒ‰é’®å…ƒç´ ');
        }
        
        if (cancelAdminLogin) {
            cancelAdminLogin.addEventListener('click', () => toggleAdminModal(false));
        }
        
        if (adminLoginForm) {
            adminLoginForm.addEventListener('submit', handleAdminLogin);
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        adminLoginModal.addEventListener('click', (e) => {
            if (e.target === adminLoginModal) {
                toggleAdminModal(false);
            }
        });

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
        });

        // é”®ç›˜äº‹ä»¶
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !loginBtn.disabled && !adminLoginModal.classList.contains('active')) {
                handleLogin();
            }
        });

        // ESCé”®å…³é—­æ¨¡æ€æ¡†ï¼ŒCtrl+Aé”®æ‰“å¼€ç®¡ç†å‘˜ç™»å½•
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && adminLoginModal.classList.contains('active')) {
                toggleAdminModal(false);
            }
            
            // Ctrl+A æ‰“å¼€ç®¡ç†å‘˜ç™»å½•æ¨¡æ€æ¡†
            if (e.ctrlKey && e.key === 'a') {
                e.preventDefault();
                console.log('Ctrl+A å¿«æ·é”®è§¦å‘ç®¡ç†å‘˜ç™»å½•');
                toggleAdminModal(true);
            }
        });
    </script>
</body>

</html>